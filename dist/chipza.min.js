!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.Chipza=n()}(this,function(){"use strict";function e(){}function n(e){return e?e.renderToString(e):void 0}function t(e){this.index_=e}function r(e,n,t,r){this.tree_=e,this.key_=n,this.rootNode=null,this.v0=t,this.v1=r}function o(e){return null===e||void 0===e}function i(e){return Array.isArray(e)}function u(e){return void 0!==e&&void 0!==e.index_}function d(){if(!o(node)){var e,n,t,r=f,s=isRoot?a:f,h=node.tag;if(h){var l=node.key,p=document.createTextNode(h);u(l)&&(r=l.index_);var v=[],x=[],y=[];(x.length>0||y.length>0)&&s===f&&(s=offset.i++);var m=node.text;if(o(m)){var g=node.children;if(!isNullOrUndef(g)){i(g)||(g=[g]);for(var w=0;w<g.length;w++){var T=d(g[w],!1,offset);T&&(v.push(T.create),T.update&&x.push(T.update),T.destroy&&y.push(T.destroy))}}}else u(m)?(v.push(enhanceTextContent(m)),s===f&&(s=offset.i++),x.push(updateTextContent(m))):p.textContent=m;e=combineCreate(s,createElement(h),v),n=combineUpdate(s,x),t=combineDestroy(s,y)}else u(node)?(e=enhanceExpression(node),n=updateExpression(node),t=null):(e=combineCreate(s,createTextNode(node),c),n=combineUpdate(s,c),t=null);return new Tree(r,e,n,t)}}function s(e){for(var n=[],o=e.length,i=0;o>i;i++)n.push(new t(i));var u=e.apply(void 0,n),s=d(u,!0,{i:o}),a=s.keyIndex;switch(o){case 0:return function(){return new r(s,null)};case 1:return 0===a?function(e){return new r(s,e,e)}:function(e){return new r(s,null,e)};default:return function(e){for(var n=arguments,t=a!==f?arguments[a]:null,o=[],i=1;i<n.length;i++)o.push(n[i]);return new r(s,t,e,o)}}}t.prototype.get=function(){return currentItem.read(this.index_)};var f=-1,a=-2,c=[];r.prototype.read=function(e){var n;return n=e===a?this.rootNode:0===e?this.v0:this.v1[e-1]},r.prototype.write=function(e,n){return n=e===a?this.rootNode:0===e?this.v0:this.v1[e-1]};var h={template:s,render:e,renderToString:n};return h});